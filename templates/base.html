<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />

    <link rel="shortcut icon" href="../static/img/leaf.png" type="image/x-icon" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style/effects.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style/newyear.css') }}" />

    {% block css %}

    {% endblock %}

    <title>
      {% block title %}

      {% endblock %}
    </title>
  </head>

  <body>
    <div id="snowflakes" aria-hidden="true"></div>
    {% include 'components/_navbar.html' %}

    <!-- New Year Popup (shows first). After close, the inline bar will appear under navbar -->
    <div id="newYearPopup" class="new-year-popup-container">
      <div class="new-year-card">
        <div class="confetti-container" id="confettiPopup"></div>
        <span class="close-btn" onclick="closeNewYearPopup()">Ã—</span>
        <h1 class="new-year-title">ðŸŽ‰ Happy New Year 2026! ðŸŽ‰</h1>
        <p class="congratulations-text">Welcome to a new chapter of growth and peace!</p>
        <div class="countdown-section">
          <p class="countdown-label">Countdown to New Year:</p>
          <div class="countdown-display">
            <div class="countdown-item">
              <span class="countdown-value" id="days_popup">00</span>
              <span class="countdown-label-small">Days</span>
            </div>
            <div class="countdown-item">
              <span class="countdown-value" id="hours_popup">00</span>
              <span class="countdown-label-small">Hours</span>
            </div>
            <div class="countdown-item">
              <span class="countdown-value" id="minutes_popup">00</span>
              <span class="countdown-label-small">Minutes</span>
            </div>
            <div class="countdown-item">
              <span class="countdown-value" id="seconds_popup">00</span>
              <span class="countdown-label-small">Seconds</span>
            </div>
          </div>
        </div>
        <p class="new-year-message" id="popupCongrats" style="display:none">Make this year count! ðŸ’šâœ¨</p>
      </div>
    </div>

    <!-- Inline New Year Countdown Bar (appears under navbar after popup is closed) -->
    <div id="newYearBar" class="new-year-bar" style="display:none">
      <div class="container d-flex align-items-center justify-content-between">
        <div class="bar-left">
          <strong>Countdown to New Year</strong>
        </div>

        <div class="countdown-display" id="countdownDisplay">
          <div class="countdown-item">
            <span class="countdown-value" id="days">00</span>
            <span class="countdown-label-small">Days</span>
          </div>
          <div class="countdown-item">
            <span class="countdown-value" id="hours">00</span>
            <span class="countdown-label-small">Hours</span>
          </div>
          <div class="countdown-item">
            <span class="countdown-value" id="minutes">00</span>
            <span class="countdown-label-small">Minutes</span>
          </div>
          <div class="countdown-item">
            <span class="countdown-value" id="seconds">00</span>
            <span class="countdown-label-small">Seconds</span>
          </div>
        </div>

        <div class="congrats-message" id="congratsMessage" style="display:none">
          <strong>ðŸŽ‰ Happy New Year 2026! ðŸŽ‰</strong>
        </div>
      </div>
      <div class="confetti-container" id="confettiContainer"></div>
    </div>

    {% block content %}

    {% endblock %}

    {% include 'components/_footer.html' %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    <!-- New Year Inline Countdown and Confetti Script -->
    <script>
      let confettiTimeout = null
      function createConfetti(containerId = 'confettiContainer', duration = 8000) {
        const container = document.getElementById(containerId)
        if (!container) return
        container.innerHTML = ''
      
        const confettiPieces = 120
        const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F']
        for (let i = 0; i < confettiPieces; i++) {
          const confetti = document.createElement('div')
          confetti.className = 'confetti-piece'
          confetti.style.left = Math.random() * 100 + '%'
          confetti.style.top = -10 + 'px'
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)]
          confetti.style.opacity = (0.5 + Math.random() * 0.8).toFixed(2)
          confetti.style.width = 6 + Math.random() * 12 + 'px'
          confetti.style.height = confetti.style.width
          confetti.style.animation = `fall ${2 + Math.random() * 3}s linear forwards`
          container.appendChild(confetti)
        }
      
        if (confettiTimeout) clearTimeout(confettiTimeout)
        confettiTimeout = setTimeout(() => {
          if (container) container.innerHTML = ''
        }, duration)
      }
      
      let _countdownTriggered = false
      function updateCountdown() {
        const now = new Date()
        const nextYear = new Date(now.getFullYear() + 1, 0, 1)
        const diff = nextYear - now
      
        const days = Math.floor(diff / (1000 * 60 * 60 * 24))
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60))
        const seconds = Math.floor((diff % (1000 * 60)) / 1000)
      
        // elements in bar
        const daysEl = document.getElementById('days')
        const hoursEl = document.getElementById('hours')
        const minutesEl = document.getElementById('minutes')
        const secondsEl = document.getElementById('seconds')
        // elements in popup
        const daysP = document.getElementById('days_popup')
        const hoursP = document.getElementById('hours_popup')
        const minutesP = document.getElementById('minutes_popup')
        const secondsP = document.getElementById('seconds_popup')
      
        const display = document.getElementById('countdownDisplay')
        const congrats = document.getElementById('congratsMessage')
        const popup = document.getElementById('newYearPopup')
        const popupCongrats = document.getElementById('popupCongrats')
      
        if (diff > 0) {
          if (daysEl) daysEl.textContent = String(days).padStart(2, '0')
          if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0')
          if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0')
          if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0')
      
          if (daysP) daysP.textContent = String(days).padStart(2, '0')
          if (hoursP) hoursP.textContent = String(hours).padStart(2, '0')
          if (minutesP) minutesP.textContent = String(minutes).padStart(2, '0')
          if (secondsP) secondsP.textContent = String(seconds).padStart(2, '0')
        } else {
          if (!_countdownTriggered) {
            _countdownTriggered = true
            // if popup still visible, show congrats there and confetti in popup
            if (popup && window.getComputedStyle(popup).display !== 'none') {
              if (popupCongrats) popupCongrats.style.display = 'block'
              createConfetti('confettiPopup', 12000)
            } else {
              if (display) display.style.display = 'none'
              if (congrats) congrats.style.display = 'block'
              createConfetti('confettiContainer', 12000)
            }
          }
        }
      }
      
      function closeNewYearPopup() {
        const popup = document.getElementById('newYearPopup')
        const bar = document.getElementById('newYearBar')
        if (popup) {
          popup.style.opacity = '0'
          setTimeout(() => {
            popup.style.display = 'none'
            if (bar) bar.style.display = 'block'
          }, 250)
        } else if (bar) {
          bar.style.display = 'block'
        }
      }
      
      document.addEventListener('DOMContentLoaded', function () {
        updateCountdown()
        setInterval(updateCountdown, 1000)
      })
    </script>

    <script>
      setTimeout(() => {
        const alertNode = document.querySelector('[role="alert"]')
        if (alertNode) {
          alertNode.remove()
        }
      }, 5000)
    </script>
    <script>
      const snowContainer = document.getElementById('snowflakes')
      if (snowContainer) {
        const flakes = 40
        for (let i = 0; i < flakes; i++) {
          const flake = document.createElement('span')
          flake.className = 'snowflake'
          flake.textContent = 'â„'
          flake.style.left = Math.random() * 100 + 'vw'
          flake.style.animationDelay = Math.random() * 5 + 's'
          flake.style.animationDuration = 6 + Math.random() * 8 + 's'
          flake.style.opacity = (0.3 + Math.random() * 0.6).toFixed(2)
          flake.style.fontSize = 12 + Math.random() * 14 + 'px'
          snowContainer.appendChild(flake)
        }
      }
    </script>
  </body>
</html>
