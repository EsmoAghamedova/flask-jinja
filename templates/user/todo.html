{% extends 'base.html' %}
{% block title %}CalmSpace - ToDo{% endblock %}

{% block css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='style/tracker.css') }}" />
{% endblock %}

{% block content %}
  <section class="container mt-5">
    <div class="glass-card p-4 mx-auto" style="max-width:800px;">
      <h2 class="text-center mb-4">To-Do</h2>

      <form method="POST" class="mb-3">
        {{ todo_form.hidden_tag() }}
        <div class="row g-2">
          <div class="col-md-6">{{ todo_form.task(class="form-control", placeholder="Task") }}</div>
          <div class="col-md-4">{{ todo_form.detail(class="form-control", placeholder="Details (optional)") }}</div>
          <div class="col-md-2">{{ todo_form.submit(class="start-btn w-100") }}</div>
        </div>
      </form>

      <h5 class="mt-4">Active</h5>
      <ul class="list-group mb-4">
        {% for t in active_todos %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <form method="POST" action="{{ url_for('user.todo_toggle', todo_id=t.id) }}" class="d-inline">
                {{ action_form.hidden_tag() }}
                <input class="form-check-input me-2" type="checkbox" onchange="this.form.submit()">
              </form>
              <strong>{{ t.task }}</strong> {% if t.detail %}- {{ t.detail }}{% endif %}
              <div><small class="text-muted">{{ t.created_at.strftime('%Y-%m-%d') }}</small></div>
            </div>
            <div>
              <a href="{{ url_for('user.todo_edit', todo_id=t.id) }}" class="btn btn-sm btn-outline-primary me-2">Edit</a>
              <form method="POST" action="{{ url_for('user.todo_delete', todo_id=t.id) }}" class="d-inline">
                {{ action_form.hidden_tag() }}
                <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
              </form>
            </div>
          </li>
        {% else %}
          <li class="list-group-item">No active tasks â€” add one above.</li>
        {% endfor %}
      </ul>

      <h5>Completed</h5>
      <ul class="list-group">
        {% for t in completed_todos %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <form method="POST" action="{{ url_for('user.todo_toggle', todo_id=t.id) }}" class="d-inline">
                {{ action_form.hidden_tag() }}
                <input class="form-check-input me-2" type="checkbox" checked onchange="this.form.submit()">
              </form>
              <strong>{{ t.task }}</strong> {% if t.detail %}- {{ t.detail }}{% endif %}
              <div><small class="text-muted">{{ t.created_at.strftime('%Y-%m-%d') }}</small></div>
            </div>
            <div>
              <a href="{{ url_for('user.todo_edit', todo_id=t.id) }}" class="btn btn-sm btn-outline-primary me-2">Edit</a>
              <form method="POST" action="{{ url_for('user.todo_delete', todo_id=t.id) }}" class="d-inline">
                {{ action_form.hidden_tag() }}
                <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
              </form>
            </div>
          </li>
        {% else %}
          <li class="list-group-item">No completed tasks yet.</li>
        {% endfor %}
      </ul>

    </div>
  </section>
{% endblock %}
